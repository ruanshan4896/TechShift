{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/lib/db.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\n\nconst sql = neon(process.env.DATABASE_URL!);\n\nexport interface Article {\n  id: number;\n  title: string;\n  slug: string;\n  content: string;\n  summary: string;\n  cover_image_url: string;\n  published_at: Date;\n  created_at: Date;\n  category_id?: number;\n  view_count: number;\n}\n\nexport interface Category {\n  id: number;\n  name: string;\n  slug: string;\n  created_at: Date;\n}\n\nexport interface Tag {\n  id: number;\n  name: string;\n  slug: string;\n  created_at: Date;\n}\n\nexport interface ArticleWithCategory extends Article {\n  category_name?: string;\n  category_slug?: string;\n}\n\nexport interface ArticleWithTags extends Article {\n  tags?: Tag[];\n}\n\nexport async function createArticlesTable() {\n  await sql`\n    CREATE TABLE IF NOT EXISTS articles (\n      id SERIAL PRIMARY KEY,\n      title TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      content TEXT NOT NULL,\n      summary TEXT NOT NULL,\n      cover_image_url TEXT NOT NULL,\n      published_at TIMESTAMP NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n      category_id INTEGER,\n      view_count INTEGER DEFAULT 0\n    )\n  `;\n}\n\nexport async function createCategoriesAndTagsTables() {\n  // Categories table\n  await sql`\n    CREATE TABLE IF NOT EXISTS categories (\n      id SERIAL PRIMARY KEY,\n      name TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  // Tags table\n  await sql`\n    CREATE TABLE IF NOT EXISTS tags (\n      id SERIAL PRIMARY KEY,\n      name TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  // Article-Tag junction table\n  await sql`\n    CREATE TABLE IF NOT EXISTS article_tags (\n      article_id INTEGER REFERENCES articles(id) ON DELETE CASCADE,\n      tag_id INTEGER REFERENCES tags(id) ON DELETE CASCADE,\n      PRIMARY KEY (article_id, tag_id)\n    )\n  `;\n\n  // Add category_id and view_count columns if not exist\n  await sql`\n    DO $$ \n    BEGIN\n      IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'articles' AND column_name = 'category_id'\n      ) THEN\n        ALTER TABLE articles ADD COLUMN category_id INTEGER;\n      END IF;\n      \n      IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'articles' AND column_name = 'view_count'\n      ) THEN\n        ALTER TABLE articles ADD COLUMN view_count INTEGER DEFAULT 0;\n      END IF;\n    END $$;\n  `;\n\n  // Add foreign key for category if not exists\n  await sql`\n    DO $$ \n    BEGIN\n      IF NOT EXISTS (\n        SELECT 1 FROM information_schema.table_constraints \n        WHERE constraint_name = 'articles_category_id_fkey'\n      ) THEN\n        ALTER TABLE articles \n        ADD CONSTRAINT articles_category_id_fkey \n        FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL;\n      END IF;\n    END $$;\n  `;\n}\n\nexport async function getLatestArticles(limit: number = 10): Promise<Article[]> {\n  const rows = await sql`\n    SELECT * FROM articles \n    ORDER BY published_at DESC \n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function getArticleBySlug(slug: string): Promise<Article | null> {\n  const rows = await sql`\n    SELECT * FROM articles \n    WHERE slug = ${slug}\n    LIMIT 1\n  `;\n  return (rows[0] as Article) || null;\n}\n\nexport async function insertArticle(article: Omit<Article, 'id' | 'created_at'>) {\n  const publishedAt = article.published_at.toISOString();\n  await sql`\n    INSERT INTO articles (title, slug, content, summary, cover_image_url, published_at)\n    VALUES (${article.title}, ${article.slug}, ${article.content}, ${article.summary}, ${article.cover_image_url}, ${publishedAt})\n  `;\n}\n\n// RSS Source Management\nexport interface RssSource {\n  id: number;\n  name: string;\n  rss_url: string;\n  is_active: boolean;\n  created_at: Date;\n}\n\nexport interface RawArticle {\n  id: number;\n  source_id: number;\n  title: string;\n  original_url: string;\n  original_content: string;\n  publication_date: Date;\n  status: 'pending' | 'processed' | 'failed';\n  created_at: Date;\n}\n\nexport async function createRssTables() {\n  await sql`\n    CREATE TABLE IF NOT EXISTS rss_sources (\n      id SERIAL PRIMARY KEY,\n      name TEXT NOT NULL,\n      rss_url TEXT UNIQUE NOT NULL,\n      is_active BOOLEAN DEFAULT true,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  await sql`\n    CREATE TABLE IF NOT EXISTS raw_articles (\n      id SERIAL PRIMARY KEY,\n      source_id INTEGER REFERENCES rss_sources(id) ON DELETE CASCADE,\n      title TEXT NOT NULL,\n      original_url TEXT UNIQUE NOT NULL,\n      original_content TEXT NOT NULL,\n      publication_date TIMESTAMP NOT NULL,\n      status TEXT CHECK (status IN ('pending', 'processed', 'failed')) DEFAULT 'pending',\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  await sql`\n    CREATE INDEX IF NOT EXISTS idx_raw_articles_status ON raw_articles(status)\n  `;\n\n  await sql`\n    CREATE INDEX IF NOT EXISTS idx_raw_articles_source ON raw_articles(source_id)\n  `;\n}\n\nexport async function getActiveRssSources(): Promise<RssSource[]> {\n  const rows = await sql`\n    SELECT * FROM rss_sources \n    WHERE is_active = true\n    ORDER BY name\n  `;\n  return rows as RssSource[];\n}\n\nexport async function getAllRssSources(): Promise<RssSource[]> {\n  const rows = await sql`\n    SELECT * FROM rss_sources \n    ORDER BY name\n  `;\n  return rows as RssSource[];\n}\n\nexport async function insertRssSource(source: Omit<RssSource, 'id' | 'created_at'>) {\n  await sql`\n    INSERT INTO rss_sources (name, rss_url, is_active)\n    VALUES (${source.name}, ${source.rss_url}, ${source.is_active})\n  `;\n}\n\nexport async function updateRssSource(id: number, source: Partial<Omit<RssSource, 'id' | 'created_at'>>) {\n  const updates: string[] = [];\n  const values: any[] = [];\n  \n  if (source.name !== undefined) {\n    updates.push(`name = $${updates.length + 1}`);\n    values.push(source.name);\n  }\n  if (source.rss_url !== undefined) {\n    updates.push(`rss_url = $${updates.length + 1}`);\n    values.push(source.rss_url);\n  }\n  if (source.is_active !== undefined) {\n    updates.push(`is_active = $${updates.length + 1}`);\n    values.push(source.is_active);\n  }\n\n  if (updates.length > 0) {\n    await sql.query(`UPDATE rss_sources SET ${updates.join(', ')} WHERE id = $${updates.length + 1}`, [...values, id]);\n  }\n}\n\nexport async function deleteRssSource(id: number) {\n  await sql`DELETE FROM rss_sources WHERE id = ${id}`;\n}\n\nexport async function checkArticleExists(originalUrl: string): Promise<boolean> {\n  const rows = await sql`\n    SELECT id FROM raw_articles WHERE original_url = ${originalUrl} LIMIT 1\n  `;\n  return rows.length > 0;\n}\n\nexport async function insertRawArticle(article: Omit<RawArticle, 'id' | 'created_at'>) {\n  const publicationDate = article.publication_date.toISOString();\n  await sql`\n    INSERT INTO raw_articles (source_id, title, original_url, original_content, publication_date, status)\n    VALUES (${article.source_id}, ${article.title}, ${article.original_url}, ${article.original_content}, ${publicationDate}, ${article.status})\n  `;\n}\n\nexport async function getPendingRawArticles(limit: number = 10): Promise<RawArticle[]> {\n  const rows = await sql`\n    SELECT * FROM raw_articles \n    WHERE status = 'pending'\n    ORDER BY publication_date DESC\n    LIMIT ${limit}\n  `;\n  return rows as RawArticle[];\n}\n\nexport async function updateRawArticleStatus(id: number, status: 'pending' | 'processed' | 'failed', error?: string) {\n  if (error) {\n    await sql`\n      UPDATE raw_articles \n      SET status = ${status}\n      WHERE id = ${id}\n    `;\n  } else {\n    await sql`\n      UPDATE raw_articles \n      SET status = ${status}\n      WHERE id = ${id}\n    `;\n  }\n}\n\nexport async function checkSlugExists(slug: string): Promise<boolean> {\n  const rows = await sql`\n    SELECT id FROM articles WHERE slug = ${slug} LIMIT 1\n  `;\n  return rows.length > 0;\n}\n\nexport async function insertArticleFromRaw(article: {\n  title: string;\n  slug: string;\n  content: string;\n  summary: string;\n  cover_image_url: string;\n  published_at: Date;\n}): Promise<void> {\n  const publishedAt = article.published_at.toISOString();\n  await sql`\n    INSERT INTO articles (title, slug, content, summary, cover_image_url, published_at)\n    VALUES (${article.title}, ${article.slug}, ${article.content}, ${article.summary}, ${article.cover_image_url}, ${publishedAt})\n  `;\n}\n\nexport async function findRelatedArticles(keyword: string, excludeSlug: string, limit: number = 2): Promise<Article[]> {\n  const rows = await sql`\n    SELECT * FROM articles \n    WHERE slug != ${excludeSlug}\n    AND (\n      title ILIKE ${`%${keyword}%`}\n      OR content ILIKE ${`%${keyword}%`}\n    )\n    ORDER BY created_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function updateArticleContent(slug: string, content: string): Promise<void> {\n  await sql`\n    UPDATE articles \n    SET content = ${content}\n    WHERE slug = ${slug}\n  `;\n}\n\n// Categories\nexport async function getAllCategories(): Promise<Category[]> {\n  const rows = await sql`SELECT * FROM categories ORDER BY name`;\n  return rows as Category[];\n}\n\nexport async function getCategoryBySlug(slug: string): Promise<Category | null> {\n  const rows = await sql`SELECT * FROM categories WHERE slug = ${slug} LIMIT 1`;\n  return (rows[0] as Category) || null;\n}\n\nexport async function insertCategory(name: string, slug: string): Promise<void> {\n  await sql`INSERT INTO categories (name, slug) VALUES (${name}, ${slug})`;\n}\n\n// Tags\nexport async function getAllTags(): Promise<Tag[]> {\n  const rows = await sql`SELECT * FROM tags ORDER BY name`;\n  return rows as Tag[];\n}\n\nexport async function getPopularTags(limit: number = 10): Promise<Tag[]> {\n  const rows = await sql`\n    SELECT t.*, COUNT(at.article_id) as article_count\n    FROM tags t\n    LEFT JOIN article_tags at ON t.id = at.tag_id\n    GROUP BY t.id\n    ORDER BY article_count DESC, t.name\n    LIMIT ${limit}\n  `;\n  return rows as Tag[];\n}\n\nexport async function getTagBySlug(slug: string): Promise<Tag | null> {\n  const rows = await sql`SELECT * FROM tags WHERE slug = ${slug} LIMIT 1`;\n  return (rows[0] as Tag) || null;\n}\n\nexport async function findOrCreateTag(name: string, slug: string): Promise<number> {\n  const existing = await sql`SELECT id FROM tags WHERE slug = ${slug} LIMIT 1`;\n  if (existing.length > 0) {\n    return existing[0].id as number;\n  }\n  const result = await sql`INSERT INTO tags (name, slug) VALUES (${name}, ${slug}) RETURNING id`;\n  return result[0].id as number;\n}\n\nexport async function getArticlesByCategory(categorySlug: string, limit: number = 20): Promise<ArticleWithCategory[]> {\n  const rows = await sql`\n    SELECT a.*, c.name as category_name, c.slug as category_slug\n    FROM articles a\n    LEFT JOIN categories c ON a.category_id = c.id\n    WHERE c.slug = ${categorySlug}\n    ORDER BY a.published_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as ArticleWithCategory[];\n}\n\nexport async function getArticlesByTag(tagSlug: string, limit: number = 20): Promise<Article[]> {\n  const rows = await sql`\n    SELECT a.*\n    FROM articles a\n    INNER JOIN article_tags at ON a.id = at.article_id\n    INNER JOIN tags t ON at.tag_id = t.id\n    WHERE t.slug = ${tagSlug}\n    ORDER BY a.published_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function getArticleTags(articleId: number): Promise<Tag[]> {\n  const rows = await sql`\n    SELECT t.*\n    FROM tags t\n    INNER JOIN article_tags at ON t.id = at.tag_id\n    WHERE at.article_id = ${articleId}\n    ORDER BY t.name\n  `;\n  return rows as Tag[];\n}\n\nexport async function linkArticleToTags(articleId: number, tagIds: number[]): Promise<void> {\n  for (const tagId of tagIds) {\n    await sql`\n      INSERT INTO article_tags (article_id, tag_id)\n      VALUES (${articleId}, ${tagId})\n      ON CONFLICT DO NOTHING\n    `;\n  }\n}\n\nexport async function searchArticles(query: string, limit: number = 20): Promise<Article[]> {\n  const searchTerm = `%${query}%`;\n  const rows = await sql`\n    SELECT * FROM articles\n    WHERE title ILIKE ${searchTerm} OR content ILIKE ${searchTerm}\n    ORDER BY published_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function incrementViewCount(slug: string): Promise<void> {\n  await sql`\n    UPDATE articles \n    SET view_count = view_count + 1\n    WHERE slug = ${slug}\n  `;\n}\n\nexport async function getFeaturedArticles(limit: number = 5): Promise<Article[]> {\n  const rows = await sql`\n    SELECT * FROM articles\n    ORDER BY view_count DESC, published_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/components/Breadcrumbs.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/Breadcrumbs.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/Breadcrumbs.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA8R,GAC3T,4DACA","ignoreList":[0]}},
    {"offset": {"line": 461, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/components/Breadcrumbs.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/Breadcrumbs.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/Breadcrumbs.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0Q,GACvS,wCACA","ignoreList":[0]}},
    {"offset": {"line": 475, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 483, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/components/Sidebar.tsx"],"sourcesContent":["import Link from 'next/link';\nimport { getFeaturedArticles, getLatestArticles, getPopularTags } from '@/lib/db';\nimport { Eye, Clock, Tag } from 'lucide-react';\n\nexport default async function Sidebar() {\n  const featured = await getFeaturedArticles(5);\n  const latest = await getLatestArticles(5);\n  const tags = await getPopularTags(10);\n\n  return (\n    <aside className=\"space-y-6\">\n      {/* Featured Articles */}\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Eye className=\"text-blue-700\" size={20} />\n          <h3 className=\"text-xl font-bold text-gray-900\">Bài viết nổi bật</h3>\n        </div>\n        <div className=\"space-y-4\">\n          {featured.map((article) => (\n            <Link\n              key={article.id}\n              href={`/posts/${article.slug}`}\n              className=\"block group\"\n            >\n              <h4 className=\"font-medium text-sm line-clamp-2 group-hover:text-blue-700 transition\">\n                {article.title}\n              </h4>\n              <p className=\"text-xs text-gray-500 mt-1 flex items-center gap-1\">\n                <Eye size={12} />\n                {article.view_count} lượt xem\n              </p>\n            </Link>\n          ))}\n        </div>\n      </div>\n\n      {/* Latest Articles */}\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Clock className=\"text-blue-700\" size={20} />\n          <h3 className=\"text-xl font-bold text-gray-900\">Bài viết mới nhất</h3>\n        </div>\n        <div className=\"space-y-4\">\n          {latest.map((article) => (\n            <Link\n              key={article.id}\n              href={`/posts/${article.slug}`}\n              className=\"block group\"\n            >\n              <h4 className=\"font-medium text-sm line-clamp-2 group-hover:text-blue-700 transition\">\n                {article.title}\n              </h4>\n              <p className=\"text-xs text-gray-500 mt-1\">\n                {new Date(article.published_at).toLocaleDateString('vi-VN')}\n              </p>\n            </Link>\n          ))}\n        </div>\n      </div>\n\n      {/* Popular Tags */}\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Tag className=\"text-blue-700\" size={20} />\n          <h3 className=\"text-xl font-bold text-gray-900\">Tags phổ biến</h3>\n        </div>\n        <div className=\"flex flex-wrap gap-2\">\n          {tags.map((tag) => (\n            <Link\n              key={tag.id}\n              href={`/tags/${tag.slug}`}\n              className=\"px-3 py-1 bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded-full text-sm transition\"\n            >\n              {tag.name}\n            </Link>\n          ))}\n        </div>\n      </div>\n    </aside>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AAAA;;;;;AAEe,eAAe;IAC5B,MAAM,WAAW,MAAM,IAAA,gIAAmB,EAAC;IAC3C,MAAM,SAAS,MAAM,IAAA,8HAAiB,EAAC;IACvC,MAAM,OAAO,MAAM,IAAA,2HAAc,EAAC;IAElC,qBACE,8OAAC;QAAM,WAAU;;0BAEf,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,uMAAG;gCAAC,WAAU;gCAAgB,MAAM;;;;;;0CACrC,8OAAC;gCAAG,WAAU;0CAAkC;;;;;;;;;;;;kCAElD,8OAAC;wBAAI,WAAU;kCACZ,SAAS,GAAG,CAAC,CAAC,wBACb,8OAAC,0LAAI;gCAEH,MAAM,CAAC,OAAO,EAAE,QAAQ,IAAI,EAAE;gCAC9B,WAAU;;kDAEV,8OAAC;wCAAG,WAAU;kDACX,QAAQ,KAAK;;;;;;kDAEhB,8OAAC;wCAAE,WAAU;;0DACX,8OAAC,uMAAG;gDAAC,MAAM;;;;;;4CACV,QAAQ,UAAU;4CAAC;;;;;;;;+BATjB,QAAQ,EAAE;;;;;;;;;;;;;;;;0BAiBvB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,6MAAK;gCAAC,WAAU;gCAAgB,MAAM;;;;;;0CACvC,8OAAC;gCAAG,WAAU;0CAAkC;;;;;;;;;;;;kCAElD,8OAAC;wBAAI,WAAU;kCACZ,OAAO,GAAG,CAAC,CAAC,wBACX,8OAAC,0LAAI;gCAEH,MAAM,CAAC,OAAO,EAAE,QAAQ,IAAI,EAAE;gCAC9B,WAAU;;kDAEV,8OAAC;wCAAG,WAAU;kDACX,QAAQ,KAAK;;;;;;kDAEhB,8OAAC;wCAAE,WAAU;kDACV,IAAI,KAAK,QAAQ,YAAY,EAAE,kBAAkB,CAAC;;;;;;;+BARhD,QAAQ,EAAE;;;;;;;;;;;;;;;;0BAgBvB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,uMAAG;gCAAC,WAAU;gCAAgB,MAAM;;;;;;0CACrC,8OAAC;gCAAG,WAAU;0CAAkC;;;;;;;;;;;;kCAElD,8OAAC;wBAAI,WAAU;kCACZ,KAAK,GAAG,CAAC,CAAC,oBACT,8OAAC,0LAAI;gCAEH,MAAM,CAAC,MAAM,EAAE,IAAI,IAAI,EAAE;gCACzB,WAAU;0CAET,IAAI,IAAI;+BAJJ,IAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;AAWzB"}},
    {"offset": {"line": 709, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/app/search/page.tsx"],"sourcesContent":["import { searchArticles } from '@/lib/db';\nimport Breadcrumbs from '@/components/Breadcrumbs';\nimport Sidebar from '@/components/Sidebar';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport { Calendar, Eye, Search as SearchIcon } from 'lucide-react';\nimport type { Metadata } from 'next';\n\ninterface PageProps {\n  searchParams: Promise<{ q?: string }>;\n}\n\nexport async function generateMetadata({ searchParams }: PageProps): Promise<Metadata> {\n  const { q } = await searchParams;\n  \n  return {\n    title: q ? `Tìm kiếm: ${q} - Tech News` : 'Tìm kiếm - Tech News',\n    description: q ? `Kết quả tìm kiếm cho \"${q}\"` : 'Tìm kiếm bài viết',\n  };\n}\n\nexport default async function SearchPage({ searchParams }: PageProps) {\n  const { q } = await searchParams;\n  const query = q || '';\n  const results = query ? await searchArticles(query, 50) : [];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Breadcrumbs items={[{ label: 'Tìm kiếm' }]} />\n        \n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          <div className=\"lg:col-span-2\">\n            <div className=\"flex items-center gap-3 mb-6\">\n              <SearchIcon className=\"text-blue-700\" size={32} />\n              <h1 className=\"text-3xl font-bold text-gray-900\">\n                {query ? `Kết quả tìm kiếm: \"${query}\"` : 'Tìm kiếm'}\n              </h1>\n            </div>\n            \n            {!query ? (\n              <div className=\"bg-white rounded-lg shadow-md p-8 text-center\">\n                <SearchIcon className=\"mx-auto text-gray-400 mb-4\" size={48} />\n                <p className=\"text-gray-600\">\n                  Nhập từ khóa vào ô tìm kiếm ở trên để bắt đầu.\n                </p>\n              </div>\n            ) : results.length === 0 ? (\n              <div className=\"bg-white rounded-lg shadow-md p-8 text-center\">\n                <SearchIcon className=\"mx-auto text-gray-400 mb-4\" size={48} />\n                <p className=\"text-gray-600 mb-2\">\n                  Không tìm thấy kết quả nào cho \"{query}\"\n                </p>\n                <p className=\"text-gray-500 text-sm\">\n                  Thử tìm kiếm với từ khóa khác hoặc kiểm tra lại chính tả.\n                </p>\n              </div>\n            ) : (\n              <>\n                <p className=\"text-gray-600 mb-6\">\n                  Tìm thấy <span className=\"font-semibold text-gray-900\">{results.length}</span> kết quả\n                </p>\n                \n                <div className=\"space-y-6\">\n                  {results.map((article) => (\n                    <Link\n                      key={article.id}\n                      href={`/posts/${article.slug}`}\n                      className=\"block bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition group\"\n                    >\n                      <div className=\"md:flex\">\n                        <div className=\"md:w-64 h-48 md:h-auto relative\">\n                          <Image\n                            src={article.cover_image_url}\n                            alt={article.title}\n                            fill\n                            className=\"object-cover\"\n                          />\n                        </div>\n                        <div className=\"p-6 flex-1\">\n                          <h2 className=\"text-xl font-semibold text-gray-900 mb-2 group-hover:text-blue-700 transition\">\n                            {article.title}\n                          </h2>\n                          <p className=\"text-gray-600 text-sm line-clamp-2 mb-4\">\n                            {article.summary}\n                          </p>\n                          <div className=\"flex items-center gap-4 text-sm text-gray-500\">\n                            <span className=\"flex items-center gap-1\">\n                              <Calendar size={16} />\n                              {new Date(article.published_at).toLocaleDateString('vi-VN')}\n                            </span>\n                            <span className=\"flex items-center gap-1\">\n                              <Eye size={16} />\n                              {article.view_count} lượt xem\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    </Link>\n                  ))}\n                </div>\n              </>\n            )}\n          </div>\n          \n          <Sidebar />\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;;;;;;AAOO,eAAe,iBAAiB,EAAE,YAAY,EAAa;IAChE,MAAM,EAAE,CAAC,EAAE,GAAG,MAAM;IAEpB,OAAO;QACL,OAAO,IAAI,CAAC,UAAU,EAAE,EAAE,YAAY,CAAC,GAAG;QAC1C,aAAa,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC,CAAC,GAAG;IACnD;AACF;AAEe,eAAe,WAAW,EAAE,YAAY,EAAa;IAClE,MAAM,EAAE,CAAC,EAAE,GAAG,MAAM;IACpB,MAAM,QAAQ,KAAK;IACnB,MAAM,UAAU,QAAQ,MAAM,IAAA,2HAAc,EAAC,OAAO,MAAM,EAAE;IAE5D,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC,qIAAW;oBAAC,OAAO;wBAAC;4BAAE,OAAO;wBAAW;qBAAE;;;;;;8BAE3C,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,gNAAU;4CAAC,WAAU;4CAAgB,MAAM;;;;;;sDAC5C,8OAAC;4CAAG,WAAU;sDACX,QAAQ,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAC,GAAG;;;;;;;;;;;;gCAI7C,CAAC,sBACA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,gNAAU;4CAAC,WAAU;4CAA6B,MAAM;;;;;;sDACzD,8OAAC;4CAAE,WAAU;sDAAgB;;;;;;;;;;;2CAI7B,QAAQ,MAAM,KAAK,kBACrB,8OAAC;oCAAI,WAAU;;sDACb,8OAAC,gNAAU;4CAAC,WAAU;4CAA6B,MAAM;;;;;;sDACzD,8OAAC;4CAAE,WAAU;;gDAAqB;gDACC;gDAAM;;;;;;;sDAEzC,8OAAC;4CAAE,WAAU;sDAAwB;;;;;;;;;;;yDAKvC;;sDACE,8OAAC;4CAAE,WAAU;;gDAAqB;8DACvB,8OAAC;oDAAK,WAAU;8DAA+B,QAAQ,MAAM;;;;;;gDAAQ;;;;;;;sDAGhF,8OAAC;4CAAI,WAAU;sDACZ,QAAQ,GAAG,CAAC,CAAC,wBACZ,8OAAC,0LAAI;oDAEH,MAAM,CAAC,OAAO,EAAE,QAAQ,IAAI,EAAE;oDAC9B,WAAU;8DAEV,cAAA,8OAAC;wDAAI,WAAU;;0EACb,8OAAC;gEAAI,WAAU;0EACb,cAAA,8OAAC,wIAAK;oEACJ,KAAK,QAAQ,eAAe;oEAC5B,KAAK,QAAQ,KAAK;oEAClB,IAAI;oEACJ,WAAU;;;;;;;;;;;0EAGd,8OAAC;gEAAI,WAAU;;kFACb,8OAAC;wEAAG,WAAU;kFACX,QAAQ,KAAK;;;;;;kFAEhB,8OAAC;wEAAE,WAAU;kFACV,QAAQ,OAAO;;;;;;kFAElB,8OAAC;wEAAI,WAAU;;0FACb,8OAAC;gFAAK,WAAU;;kGACd,8OAAC,sNAAQ;wFAAC,MAAM;;;;;;oFACf,IAAI,KAAK,QAAQ,YAAY,EAAE,kBAAkB,CAAC;;;;;;;0FAErD,8OAAC;gFAAK,WAAU;;kGACd,8OAAC,uMAAG;wFAAC,MAAM;;;;;;oFACV,QAAQ,UAAU;oFAAC;;;;;;;;;;;;;;;;;;;;;;;;;mDA3BvB,QAAQ,EAAE;;;;;;;;;;;;;;;;;;sCAuC3B,8OAAC,iIAAO;;;;;;;;;;;;;;;;;;;;;;AAKlB"}}]
}