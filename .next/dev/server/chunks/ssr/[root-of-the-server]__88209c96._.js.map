{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/lib/db.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\n\nconst sql = neon(process.env.DATABASE_URL!);\n\nexport interface Article {\n  id: number;\n  title: string;\n  slug: string;\n  content: string;\n  summary: string;\n  cover_image_url: string;\n  published_at: Date;\n  created_at: Date;\n}\n\nexport async function createArticlesTable() {\n  await sql`\n    CREATE TABLE IF NOT EXISTS articles (\n      id SERIAL PRIMARY KEY,\n      title TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      content TEXT NOT NULL,\n      summary TEXT NOT NULL,\n      cover_image_url TEXT NOT NULL,\n      published_at TIMESTAMP NOT NULL,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n}\n\nexport async function getLatestArticles(limit: number = 10): Promise<Article[]> {\n  const rows = await sql`\n    SELECT * FROM articles \n    ORDER BY published_at DESC \n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function getArticleBySlug(slug: string): Promise<Article | null> {\n  const rows = await sql`\n    SELECT * FROM articles \n    WHERE slug = ${slug}\n    LIMIT 1\n  `;\n  return (rows[0] as Article) || null;\n}\n\nexport async function insertArticle(article: Omit<Article, 'id' | 'created_at'>) {\n  const publishedAt = article.published_at.toISOString();\n  await sql`\n    INSERT INTO articles (title, slug, content, summary, cover_image_url, published_at)\n    VALUES (${article.title}, ${article.slug}, ${article.content}, ${article.summary}, ${article.cover_image_url}, ${publishedAt})\n  `;\n}\n\n// RSS Source Management\nexport interface RssSource {\n  id: number;\n  name: string;\n  rss_url: string;\n  is_active: boolean;\n  created_at: Date;\n}\n\nexport interface RawArticle {\n  id: number;\n  source_id: number;\n  title: string;\n  original_url: string;\n  original_content: string;\n  publication_date: Date;\n  status: 'pending' | 'processed' | 'failed';\n  created_at: Date;\n}\n\nexport async function createRssTables() {\n  await sql`\n    CREATE TABLE IF NOT EXISTS rss_sources (\n      id SERIAL PRIMARY KEY,\n      name TEXT NOT NULL,\n      rss_url TEXT UNIQUE NOT NULL,\n      is_active BOOLEAN DEFAULT true,\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  await sql`\n    CREATE TABLE IF NOT EXISTS raw_articles (\n      id SERIAL PRIMARY KEY,\n      source_id INTEGER REFERENCES rss_sources(id) ON DELETE CASCADE,\n      title TEXT NOT NULL,\n      original_url TEXT UNIQUE NOT NULL,\n      original_content TEXT NOT NULL,\n      publication_date TIMESTAMP NOT NULL,\n      status TEXT CHECK (status IN ('pending', 'processed', 'failed')) DEFAULT 'pending',\n      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n  `;\n\n  await sql`\n    CREATE INDEX IF NOT EXISTS idx_raw_articles_status ON raw_articles(status)\n  `;\n\n  await sql`\n    CREATE INDEX IF NOT EXISTS idx_raw_articles_source ON raw_articles(source_id)\n  `;\n}\n\nexport async function getActiveRssSources(): Promise<RssSource[]> {\n  const rows = await sql`\n    SELECT * FROM rss_sources \n    WHERE is_active = true\n    ORDER BY name\n  `;\n  return rows as RssSource[];\n}\n\nexport async function getAllRssSources(): Promise<RssSource[]> {\n  const rows = await sql`\n    SELECT * FROM rss_sources \n    ORDER BY name\n  `;\n  return rows as RssSource[];\n}\n\nexport async function insertRssSource(source: Omit<RssSource, 'id' | 'created_at'>) {\n  await sql`\n    INSERT INTO rss_sources (name, rss_url, is_active)\n    VALUES (${source.name}, ${source.rss_url}, ${source.is_active})\n  `;\n}\n\nexport async function updateRssSource(id: number, source: Partial<Omit<RssSource, 'id' | 'created_at'>>) {\n  const updates: string[] = [];\n  const values: any[] = [];\n  \n  if (source.name !== undefined) {\n    updates.push(`name = $${updates.length + 1}`);\n    values.push(source.name);\n  }\n  if (source.rss_url !== undefined) {\n    updates.push(`rss_url = $${updates.length + 1}`);\n    values.push(source.rss_url);\n  }\n  if (source.is_active !== undefined) {\n    updates.push(`is_active = $${updates.length + 1}`);\n    values.push(source.is_active);\n  }\n\n  if (updates.length > 0) {\n    await sql.query(`UPDATE rss_sources SET ${updates.join(', ')} WHERE id = $${updates.length + 1}`, [...values, id]);\n  }\n}\n\nexport async function deleteRssSource(id: number) {\n  await sql`DELETE FROM rss_sources WHERE id = ${id}`;\n}\n\nexport async function checkArticleExists(originalUrl: string): Promise<boolean> {\n  const rows = await sql`\n    SELECT id FROM raw_articles WHERE original_url = ${originalUrl} LIMIT 1\n  `;\n  return rows.length > 0;\n}\n\nexport async function insertRawArticle(article: Omit<RawArticle, 'id' | 'created_at'>) {\n  const publicationDate = article.publication_date.toISOString();\n  await sql`\n    INSERT INTO raw_articles (source_id, title, original_url, original_content, publication_date, status)\n    VALUES (${article.source_id}, ${article.title}, ${article.original_url}, ${article.original_content}, ${publicationDate}, ${article.status})\n  `;\n}\n\nexport async function getPendingRawArticles(limit: number = 10): Promise<RawArticle[]> {\n  const rows = await sql`\n    SELECT * FROM raw_articles \n    WHERE status = 'pending'\n    ORDER BY publication_date DESC\n    LIMIT ${limit}\n  `;\n  return rows as RawArticle[];\n}\n\nexport async function updateRawArticleStatus(id: number, status: 'pending' | 'processed' | 'failed', error?: string) {\n  if (error) {\n    await sql`\n      UPDATE raw_articles \n      SET status = ${status}\n      WHERE id = ${id}\n    `;\n  } else {\n    await sql`\n      UPDATE raw_articles \n      SET status = ${status}\n      WHERE id = ${id}\n    `;\n  }\n}\n\nexport async function checkSlugExists(slug: string): Promise<boolean> {\n  const rows = await sql`\n    SELECT id FROM articles WHERE slug = ${slug} LIMIT 1\n  `;\n  return rows.length > 0;\n}\n\nexport async function insertArticleFromRaw(article: {\n  title: string;\n  slug: string;\n  content: string;\n  summary: string;\n  cover_image_url: string;\n  published_at: Date;\n}): Promise<void> {\n  const publishedAt = article.published_at.toISOString();\n  await sql`\n    INSERT INTO articles (title, slug, content, summary, cover_image_url, published_at)\n    VALUES (${article.title}, ${article.slug}, ${article.content}, ${article.summary}, ${article.cover_image_url}, ${publishedAt})\n  `;\n}\n\nexport async function findRelatedArticles(keyword: string, excludeSlug: string, limit: number = 2): Promise<Article[]> {\n  const rows = await sql`\n    SELECT * FROM articles \n    WHERE slug != ${excludeSlug}\n    AND (\n      title ILIKE ${`%${keyword}%`}\n      OR content ILIKE ${`%${keyword}%`}\n    )\n    ORDER BY created_at DESC\n    LIMIT ${limit}\n  `;\n  return rows as Article[];\n}\n\nexport async function updateArticleContent(slug: string, content: string): Promise<void> {\n  await sql`\n    UPDATE articles \n    SET content = ${content}\n    WHERE slug = ${slug}\n  `;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/components/ArticleContent.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/ArticleContent.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/ArticleContent.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAiS,GAC9T,+DACA","ignoreList":[0]}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/components/ArticleContent.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/ArticleContent.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/ArticleContent.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6Q,GAC1S,2CACA","ignoreList":[0]}},
    {"offset": {"line": 277, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///Users/ruanshan/Desktop/test%20kiro/tech-news/app/posts/%5Bslug%5D/page.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport Link from \"next/link\";\nimport { notFound } from \"next/navigation\";\nimport { getArticleBySlug } from \"@/lib/db\";\nimport type { Metadata } from \"next\";\nimport ArticleContent from \"@/components/ArticleContent\";\n\ninterface PageProps {\n  params: Promise<{ slug: string }>;\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const { slug } = await params;\n  const article = await getArticleBySlug(slug);\n\n  if (!article) {\n    return {\n      title: \"Không tìm thấy bài viết\",\n    };\n  }\n\n  return {\n    title: `${article.title} - Tech News`,\n    description: article.summary,\n    openGraph: {\n      title: article.title,\n      description: article.summary,\n      images: [article.cover_image_url],\n    },\n  };\n}\n\nexport default async function PostPage({ params }: PageProps) {\n  const { slug } = await params;\n  const article = await getArticleBySlug(slug);\n\n  if (!article) {\n    notFound();\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <Link\n            href=\"/\"\n            className=\"text-blue-700 hover:text-blue-900 font-semibold inline-flex items-center gap-2\"\n          >\n            ← Quay lại trang chủ\n          </Link>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        <article className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n          <div className=\"relative h-96 w-full\">\n            <Image\n              src={article.cover_image_url}\n              alt={article.title}\n              fill\n              className=\"object-cover\"\n              priority\n            />\n          </div>\n\n          <div className=\"p-8\">\n            <div className=\"mb-4 text-sm text-gray-600 font-medium\">\n              {new Date(article.published_at).toLocaleDateString('vi-VN', {\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric'\n              })}\n            </div>\n\n            <h1 className=\"text-4xl font-bold text-gray-900 mb-4 leading-tight\">\n              {article.title}\n            </h1>\n\n            <p className=\"text-xl text-gray-700 mb-8 italic border-l-4 border-blue-600 pl-4\">\n              {article.summary}\n            </p>\n\n            <ArticleContent content={article.content} />\n          </div>\n        </article>\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AAAA;AACA;AAEA;;;;;;;AAMO,eAAe,iBAAiB,EAAE,MAAM,EAAa;IAC1D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;IACvB,MAAM,UAAU,MAAM,IAAA,6HAAgB,EAAC;IAEvC,IAAI,CAAC,SAAS;QACZ,OAAO;YACL,OAAO;QACT;IACF;IAEA,OAAO;QACL,OAAO,GAAG,QAAQ,KAAK,CAAC,YAAY,CAAC;QACrC,aAAa,QAAQ,OAAO;QAC5B,WAAW;YACT,OAAO,QAAQ,KAAK;YACpB,aAAa,QAAQ,OAAO;YAC5B,QAAQ;gBAAC,QAAQ,eAAe;aAAC;QACnC;IACF;AACF;AAEe,eAAe,SAAS,EAAE,MAAM,EAAa;IAC1D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;IACvB,MAAM,UAAU,MAAM,IAAA,6HAAgB,EAAC;IAEvC,IAAI,CAAC,SAAS;QACZ,IAAA,iMAAQ;IACV;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAO,WAAU;0BAChB,cAAA,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC,0LAAI;wBACH,MAAK;wBACL,WAAU;kCACX;;;;;;;;;;;;;;;;0BAML,8OAAC;gBAAK,WAAU;0BACd,cAAA,8OAAC;oBAAQ,WAAU;;sCACjB,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,wIAAK;gCACJ,KAAK,QAAQ,eAAe;gCAC5B,KAAK,QAAQ,KAAK;gCAClB,IAAI;gCACJ,WAAU;gCACV,QAAQ;;;;;;;;;;;sCAIZ,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CACZ,IAAI,KAAK,QAAQ,YAAY,EAAE,kBAAkB,CAAC,SAAS;wCAC1D,MAAM;wCACN,OAAO;wCACP,KAAK;oCACP;;;;;;8CAGF,8OAAC;oCAAG,WAAU;8CACX,QAAQ,KAAK;;;;;;8CAGhB,8OAAC;oCAAE,WAAU;8CACV,QAAQ,OAAO;;;;;;8CAGlB,8OAAC,wIAAc;oCAAC,SAAS,QAAQ,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMpD"}}]
}